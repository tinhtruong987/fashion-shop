<div class="p-6">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold text-gray-900">Quản lý sản phẩm</h1>
    <p-button
      icon="pi pi-plus"
      label="Thêm sản phẩm"
      (onClick)="createProduct()"
    ></p-button>
  </div>

  <p-table
    [value]="products"
    [loading]="loading"
    [paginator]="true"
    [rows]="10"
    [showCurrentPageReport]="true"
    currentPageReportTemplate="Hiển thị {first} đến {last} của {totalRecords} sản phẩm"
    [rowsPerPageOptions]="[10, 25, 50]"
    styleClass="p-datatable-sm"
  >
    <ng-template pTemplate="header">
      <tr>
        <th style="width: 100px">Mã SP</th>
        <th>Tên sản phẩm</th>
        <th>Danh mục</th>
        <th style="width: 150px">Giá</th>
        <th style="width: 100px">Tồn kho</th>
        <th style="width: 100px">Trạng thái</th>
        <th style="width: 150px">Thao tác</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-product>
      <tr>
        <td>{{ product.productCode }}</td>
        <td>{{ product.name }}</td>
        <td>{{ product.category?.categoryName }}</td>
        <td>{{ product.price | currency : "VND" }}</td>
        <td>
          <span
            [ngClass]="{
              'text-red-500 font-bold': getTotalStock(product) < 10
            }"
          >
            {{ getTotalStock(product) }}
          </span>
        </td>
        <td>
          <p-tag [severity]="product.isActive ? 'success' : 'danger'">
            {{ product.isActive ? "Hoạt động" : "Ngừng bán" }}
          </p-tag>
        </td>
        <td>
          <div class="flex gap-2">
            <p-button
              icon="pi pi-eye"
              styleClass="p-button-rounded p-button-text"
              (onClick)="viewProductDetails(product)"
              pTooltip="Xem chi tiết"
            ></p-button>
            <p-button
              icon="pi pi-pencil"
              styleClass="p-button-rounded p-button-text"
              (onClick)="editProduct(product)"
              pTooltip="Sửa"
            ></p-button>
            <p-button
              icon="pi pi-trash"
              styleClass="p-button-rounded p-button-text p-button-danger"
              (onClick)="deleteProduct(product)"
              pTooltip="Xóa"
            ></p-button>
          </div>
        </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="7" class="text-center p-4">
          <div class="text-gray-500">Không có sản phẩm nào</div>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>

<!-- Dialog thêm/sửa sản phẩm -->
<p-dialog
  [(visible)]="displayDialog"
  [style]="{ width: '600px' }"
  [header]="product.productID === 0 ? 'Thêm sản phẩm mới' : 'Sửa sản phẩm'"
  [modal]="true"
  [draggable]="false"
  [resizable]="false"
>
  <div class="grid grid-cols-2 gap-4">
    <div class="field col-span-2">
      <label for="productCode" class="block mb-2">Mã sản phẩm</label>
      <input
        id="productCode"
        type="text"
        pInputText
        [(ngModel)]="product.productCode"
        class="w-full"
        required
      />
    </div>

    <div class="field col-span-2">
      <label for="name" class="block mb-2">Tên sản phẩm</label>
      <input
        id="name"
        type="text"
        pInputText
        [(ngModel)]="product.name"
        class="w-full"
        required
      />
    </div>

    <div class="field">
      <label for="category" class="block mb-2">Danh mục</label>
      <p-dropdown
        id="category"
        [options]="[]"
        [(ngModel)]="product.categoryID"
        optionLabel="categoryName"
        optionValue="categoryID"
        placeholder="Chọn danh mục"
        class="w-full"
      ></p-dropdown>
    </div>

    <div class="field">
      <label for="price" class="block mb-2">Giá</label>
      <p-inputNumber
        id="price"
        [(ngModel)]="product.price"
        mode="currency"
        currency="VND"
        locale="vi-VN"
        class="w-full"
      ></p-inputNumber>
    </div>

    <div class="field col-span-2">
      <label for="description" class="block mb-2">Mô tả</label>
      <textarea
        id="description"
        pInputTextarea
        [(ngModel)]="product.description"
        [rows]="3"
        class="w-full"
      ></textarea>
    </div>

    <div class="field col-span-2">
      <p-checkbox
        [(ngModel)]="product.isActive"
        [binary]="true"
        label="Sản phẩm đang bán"
      ></p-checkbox>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <p-button
      icon="pi pi-times"
      label="Hủy"
      styleClass="p-button-text"
      (onClick)="displayDialog = false"
    ></p-button>
    <p-button
      icon="pi pi-check"
      label="Lưu"
      (onClick)="saveProduct()"
    ></p-button>
  </ng-template>
</p-dialog>

<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>
